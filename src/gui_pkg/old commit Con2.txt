package gui_pkg;


import static gui_pkg.Signin.emailsigin;
import static gui_pkg.Signin.namesigin;
import static gui_pkg.Signin.numsigin;
import static gui_pkg.Signin.pwdsignin;

import java.awt.Component;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.logging.Level;
import java.util.logging.Logger;

import javax.swing.JOptionPane;

/**
 *
 * @author Apex: arshad ali bhorania
 */
public class Con2
{       
    String name;
    String number;
    String email;
    String pwd;
    String loginemail;
    String loginpwd;
    
    public static Connection con;
    static ResultSet rs;
    static PreparedStatement ps;
    private Component rootPane;

    public Con2() {
    }
    
    void getCon() throws ClassNotFoundException, SQLException
    {
        //1. Load Drivers
        Class.forName("com.mysql.jdbc.Driver");
        //System.out.println("Driver loaded successfully.");

        //2. Make connection
        con =(Connection) DriverManager.getConnection("jdbc:mysql://localhost:3306/projects", "root", "");
        //System.out.println("Connection successfully.");
    }
    
	@SuppressWarnings("deprecation")
    void signin() throws ClassNotFoundException, SQLException
    {
        getCon();
        name = namesigin.getText();
        number = numsigin.getText();
        //double n= Double.parseDouble(number);
        email = emailsigin.getText();
        pwd = pwdsignin.getText();
        
        if(name.equals("") ){
                JOptionPane.showMessageDialog(null, " enter name ! ");
        }
        else if(number.equals("")){
                JOptionPane.showMessageDialog(null, " enter number ! ");
        }
        else if(email.equals("")){
                JOptionPane.showMessageDialog(null, " enter email ! ");
        }
        else if(pwd.equals("")){
                JOptionPane.showMessageDialog(null, " enter password ! ");
        }
        else{
            
            double n= Double.parseDouble(number);
                
            String sql="insert into registration_details(name,number,email,password)values(?,?,?,?)";
            ps=(PreparedStatement) con.prepareStatement(sql);
            ps.setString(1, name);
            ps.setDouble(2,n);
            ps.setString(3, email);
            ps.setString(4, pwd);
            
//            ps.setString(1, "arshad ali");
//            ps.setInt(2, 9898696210);
//            ps.setString(3, "bhoraniyaarshadali431@gmail.com");
//            ps.setString(4, "#Ali1234");



                        //int i=0;
                        int i=ps.executeUpdate();
                        //System.out.println(i);
                        
                        if(email.equals(emailsigin))
                        {
                    
                            sql=("select * from registration_details where Email=?"); //quary
                            ps=(PreparedStatement) con.prepareStatement(sql);
                            ps.setString(3, email);
                            rs=(ResultSet) ps.executeQuery();
                            JOptionPane.showMessageDialog(null, "Email already registered !","Error", JOptionPane.HEIGHT);
                        }
                        
                        else if(i!=0)
                        {
                        //System.out.println(i+" record inserted ");
                        JOptionPane.showMessageDialog(rootPane, " Signin Successfully ");
                        }
                        else  {
                        //System.out.println("not inserted ");
                        //System.out.println(i);
                        JOptionPane.showMessageDialog(rootPane," record not inserted ");
                        }
                        
        
                        
                        if(i>0)
                        {
                            Welcome_Page obj= new Welcome_Page();
                            obj.setVisible(true);
                        }
                        else{
                            JOptionPane.showMessageDialog(rootPane, "Email already exists !");
                        }
            }
        
        
                
        
        
//                String sql1="select * from user_info where Email=?";
//                if(sql1.equals(sql1)){
//                    String email1;
//                    String number1;
//            
//                    email1=forgot_email.getText();
//                    number1 = forgot_number.getText();
//           
//            String sql=("select * from user_info where Email=?");
//            ps=(PreparedStatement) con.prepareStatement(sql);
//            //ps.setString(1, email1);
//                rs=(ResultSet) ps.executeQuery();
//                }else{
//                      
//                }   
    }
    @SuppressWarnings("deprecation")
	void login() throws ClassNotFoundException {
        try {
            getCon();
        } catch (SQLException ex) {
            Logger.getLogger(Con2.class.getName()).log(Level.SEVERE, null, ex);
        }
        loginemail = Login.logininput.getText();                          //for email
        loginpwd = Login.pwdlogin.getText();
        //long loginpwd=Long.parseLong(Login.pwdlogin.getText());
        
        if(loginemail.equals("") && loginpwd.equals(""))
        {
          JOptionPane.showMessageDialog(null, "Email and Password should not be empty !","Error", JOptionPane.HEIGHT);
        }
        else if(loginemail.equals(""))
        {
            //JOptionPane.showMessageDialog(rootPane, " enter email ! "); 
            JOptionPane.showMessageDialog(null, "enter email !","Error", JOptionPane.HEIGHT);
        }
        else if(loginpwd.equals(""))
        {
            //JOptionPane.showMessageDialog(rootPane, " enter password ! "); 
            JOptionPane.showMessageDialog(null, "enter password !","Error", JOptionPane.HEIGHT);
        }
        else
        {
            try {
                String sql=("select * from registration_details where Email=? and Password= ?");           //quary
                ps=(PreparedStatement) con.prepareStatement(sql);
                ps.setString(1, loginemail);
                ps.setString(2,loginpwd);
                rs=(ResultSet) ps.executeQuery();
                
                
                if(rs.next())
                {
                    Welcome_Page obj= new Welcome_Page();
                    obj.setTitle("Welcome Page");
                    obj.setVisible(true);
                    System.out.println("email: "+loginemail+"\n"+"password: "+loginpwd);
                }
                else
                {  
                    JOptionPane.showMessageDialog(null, "Email or Password not found. ","Error", JOptionPane.HEIGHT);
                }
            } catch (SQLException ex) {
                Logger.getLogger(Con2.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
    }
    
//        void forgot_pwd() {
//            
//        }
    public static void main(String[] args) throws ClassNotFoundException, SQLException 
    {
        Con2 obj = new Con2();
        obj.getCon();
        obj.signin();
        //obj.forgot_pwd();
    }  
}